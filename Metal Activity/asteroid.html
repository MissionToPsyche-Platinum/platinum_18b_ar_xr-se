<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Psyche Asteroid Value Calculator</title>
  <style>
    body {
      font-family: Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, #302144, #592651);
      color: #592651;
      text-align: center;
      padding: 30px;
    }
    h1, h2 {
      color: #ffffff;
      font-weight: 300;
      letter-spacing: 0.5px;
    }
    p, td, th, span {
      font-family: Helvetica, Arial, sans-serif;
      color: #ffffff;
    }
    button {
      background: linear-gradient(90deg, #f9a000, #f47c33);
      color: #12031d;
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.3s ease;
      margin-top: 15px;
    }
    button:hover { opacity: 0.85; }
    #disclaimer {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(18,3,29,0.95);
      display: flex; justify-content: center; align-items: center;
      flex-direction: column; text-align: center;
      z-index: 999; padding: 20px;
      color: #f9a000;
    }
    #disclaimer p {
      font-size: 18px;
      max-width: 700px;
      margin-bottom: 25px;
      line-height: 1.5;
      color: #f9a000;
    }
    .page { display: none; }
    .active { display: block; }

    .asteroid-container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px auto;
      width: 100%;
      overflow: hidden;
      touch-action: none;
    }

    #asteroid-img {
      width: 40%;
      max-width: 320px;
      border-radius: 10px;
      display: block;
      margin: 0 auto;
      cursor: grab;
      user-select: none;
      transform-origin: center center;
    }

    #color-overlay {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 40%; max-width: 320px;
      aspect-ratio: 1 / 1;
      border-radius: 10px;
      pointer-events: none;
      mix-blend-mode: overlay;
      transition: background-color 0.3s ease;
    }

    input[type=file] {
      margin-top: 10px;
      color: #f9a000;
    }

    .composition-header { margin-top: 25px; }
    .slider-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px 25px;
      width: 70%;
      max-width: 600px;
      margin: 0 auto;
    }
    .slider-container { text-align: left; }
    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    input[type=range] { width: 100%; }
    #dirt, #error { margin-top: 10px; font-weight: bold; }
    #dirt { color: #f9a000; }
    #error { color: #ffffff; }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 80%;
      max-width: 600px;
    }
    th, td { border: 1px solid #592651; padding: 8px; }
    th { background: rgba(89,38,81,0.2); }
    #lastUpdated { margin-top: 15px; font-size: 14px; color: #aaaaaa; }
    #funFact { margin-top: 16px; font-size: 16px; color: #f9a000; }
  </style>
</head>
<body>
  <div id="disclaimer" class="page active">
    <p>
      Hey there! This activity is meant for fun and to spark imagination! üåå<br><br>
      The Psyche asteroid is not expected to be a viable source of precious metals ‚Äî and if it was, these current market values would not make sense with the influx of metals.<br><br>
      Please enjoy the activity as simply imaginative play!
    </p>
    <button id="continueBtn">Continue</button>
  </div>

  <div id="mainPage" class="page">
    <h1>Psyche Asteroid Value Calculator</h1>
    <div class="asteroid-container" id="imageWrap">
      <img id="asteroid-img" src="Psyche Asteroid.jpg" alt="Psyche Asteroid">
      <div id="color-overlay"></div>
    </div>

    <!-- Camera support -->
    <input type="file" id="imageInput" accept="image/*" capture="environment">

    <p style="color:#aaa;font-size:14px;">NASA Psyche Asteroid Visualization</p>
    <p style="color:#f9a000;font-size:16px;margin-top:-5px;">Estimated Volume: ‚âà 5,750,000 km<sup>3</sup></p>
    <h2 class="composition-header">Composition</h2>
    <div class="slider-grid" id="sliders"></div>
    <p id="dirt">Dirt: 100%</p>
    <p id="error"></p>
    <button id="calcBtn" onclick="calculate()">Calculate</button>
  </div>

  <div id="resultsPage" class="page">
    <h1>Results</h1>
    <table id="resultsTable">
      <thead>
        <tr><th>Metal</th><th>Percentage</th><th>Rate (USD/oz)</th><th>Total Value</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <p id="lastUpdated"></p>
    <p id="funFact"></p>
    <button id="backBtn">Back</button>
  </div>

  <script>

    const disclaimer=document.getElementById("disclaimer"),
          mainPage=document.getElementById("mainPage"),
          resultsPage=document.getElementById("resultsPage");
    document.getElementById("continueBtn").onclick=()=>{disclaimer.style.display="none";mainPage.classList.add("active");};
    document.getElementById("backBtn").onclick=()=>{resultsPage.classList.remove("active");mainPage.style.display="block";};

    const API_KEY="LMK8WWQNCCKFV6OL0HQX880OL0HQX";
    const BASE_URL="https://api.metals.dev/v1/latest";
    const VOLUME_M3=5.75e15;
    const DENSITY={gold:19300,silver:10490,platinum:21450,palladium:12000,copper:8960,nickel:8900,aluminum:2700,lead:11340,dirt:3000};
    const metalsList=["gold","silver","platinum","palladium","copper","nickel","aluminum","lead"];
    const metalColors={gold:"#FFD700",silver:"#C0C0C0",platinum:"#E5E4E2",palladium:"#CED0DD",copper:"#B87333",nickel:"#AFAFAF",aluminum:"#D3D3D3",lead:"#4D4D4D"};
    const OLYMPIC_POOL_M3=2500, INCH_TO_M=0.0254, BILL_L=6.14*INCH_TO_M, BILL_W=2.61*INCH_TO_M, BILL_T=0.0043*INCH_TO_M;
    const BILL_VOLUME_M3=BILL_L*BILL_W*BILL_T;

    function lbsToTroyOunces(lbs){return lbs*16*0.911458;}
    function formatLarge(n){
      if(!isFinite(n))return"‚àû";
      let str;
      if(n>=1e12)str=(n/1e12).toFixed(2)+" trillion";
      else if(n>=1e9)str=(n/1e9).toFixed(2)+" billion";
      else if(n>=1e6)str=(n/1e6).toFixed(2)+" million";
      else return n.toLocaleString();
      return str.replace(/\.00(?=\s)/,"");
    }

    function hexToRgb(hex){const b=parseInt(hex.slice(1),16);return{r:(b>>16)&255,g:(b>>8)&255,b:b&255};}
    function mixColors(vals){let t=0,r=0,g=0,b=0;for(const[m,p]of Object.entries(vals)){const c=hexToRgb(metalColors[m]);r+=c.r*(p/100);g+=c.g*(p/100);b+=c.b*(p/100);t+=p;}if(t===0)return"rgba(0,0,0,0)";r=Math.round(r);g=Math.round(g);b=Math.round(b);return`rgba(${r},${g},${b},${Math.min(1,t/100)})`;}
    function buildSliders(){const c=document.getElementById("sliders");c.innerHTML="";metalsList.forEach(m=>{const d=document.createElement("div");d.classList.add("slider-container");d.innerHTML=`<div class="slider-label"><span>${m.charAt(0).toUpperCase()+m.slice(1)}</span><span id="${m}-val">0%</span></div><input type="range" min="0" max="100" value="0" id="${m}-slider" oninput="updatePercent('${m}')">`;c.appendChild(d);});}
    function updatePercent(m){const s=document.getElementById(`${m}-slider`);document.getElementById(`${m}-val`).textContent=s.value+"%";validateTotal();updateOverlay();}
    function validateTotal(){let total=0;metalsList.forEach(m=>total+=parseInt(document.getElementById(`${m}-slider`).value));const e=document.getElementById("error"),b=document.getElementById("calcBtn"),d=document.getElementById("dirt");if(total>60){e.innerHTML="‚ùå Total metal composition exceeds 60%.<br>The Psyche Asteroid is thought to be 30‚Äì60% metal.";b.disabled=true;}else{e.textContent="";b.disabled=false;}d.textContent=`Dirt: ${100-total}%`;}
    function updateOverlay(){const v={};metalsList.forEach(m=>v[m]=parseInt(document.getElementById(`${m}-slider`).value));document.getElementById("color-overlay").style.backgroundColor=mixColors(v);}

    let lastApiTime=null;
    async function getRates(){
      try{
        const url=`${BASE_URL}?api_key=${API_KEY}&currency=USD`;
        const r=await fetch(url);const d=await r.json();
        if(!d.metals)throw new Error("Invalid response");
        lastApiTime=new Date();return d.metals;
      }catch(err){
        console.warn("‚ö†Ô∏è Using offline fallback rates:",err.message);
        return{gold:4362.26,silver:25.46,platinum:975.20,palladium:1100.00,copper:0.35,nickel:6.85,aluminum:1.03,lead:0.98};
      }
    }

    async function calculate(){
      try{
        const rates=await getRates();const tbody=document.querySelector("#resultsTable tbody");tbody.innerHTML="";
        let totalValue=0,totalMassKg=0;const metalMasses={};
        metalsList.forEach(m=>{
          const percent=parseInt(document.getElementById(`${m}-slider`).value);
          const volFrac=percent/100;const volM3=VOLUME_M3*volFrac;
          const massKg=volM3*DENSITY[m];metalMasses[m]=massKg;totalMassKg+=massKg;
        });
        const dirtPercent=Math.max(0,100-metalsList.reduce((a,m)=>a+parseInt(document.getElementById(`${m}-slider`).value),0));
        totalMassKg+=VOLUME_M3*(dirtPercent/100)*DENSITY.dirt;

        const totalLbs=totalMassKg*2.20462;const totalTroyOunces=lbsToTroyOunces(totalLbs);
        metalsList.forEach(m=>{
          const percent=parseInt(document.getElementById(`${m}-slider`).value);
          if(percent>0&&rates[m]){
            const frac=metalMasses[m]/totalMassKg;
            const metalOunces=totalTroyOunces*frac;
            const rate=rates[m];const value=metalOunces*rate;
            totalValue+=value;
            tbody.innerHTML+=`<tr><td>${m.charAt(0).toUpperCase()+m.slice(1)}</td><td>${percent}%</td><td>$${rate.toFixed(2)}</td><td>$${value.toLocaleString(undefined,{maximumFractionDigits:2})}</td></tr>`;
          }
        });

        tbody.innerHTML+=`<tr style="font-weight:bold;background:#222;"><td colspan="3">TOTAL</td><td>$${totalValue.toLocaleString(undefined,{maximumFractionDigits:2})}</td></tr>`;
        document.getElementById("lastUpdated").textContent=lastApiTime?`üïí Last metal price API update: ${lastApiTime.toLocaleString()}`:`‚ö†Ô∏è Using fallback prices (no recent API data)`;

        const bills=totalValue/100;const vol=bills*BILL_VOLUME_M3;const pools=vol/OLYMPIC_POOL_M3;
        const totalHeightMiles=(bills*BILL_T)/1609.34;
        const CITY_BLOCK_M3=640;let highestMetal=null,highestPct=0;
        metalsList.forEach(m=>{const pct=parseInt(document.getElementById(`${m}-slider`).value);if(pct>highestPct){highestPct=pct;highestMetal=m;}});
        const highestMetalVol=VOLUME_M3*(highestPct/100);const blocks=highestMetalVol/CITY_BLOCK_M3;

        const EARTH_CIRCUM_M=40075e3;const WIRE_RADIUS=0.005;const WIRE_AREA=Math.PI*WIRE_RADIUS*WIRE_RADIUS;
        const wireParts=[];
        metalsList.forEach(m=>{
          const pct=parseInt(document.getElementById(`${m}-slider`).value);
          if(pct>0){
            const volM3=VOLUME_M3*(pct/100);const length=volM3/WIRE_AREA;const wraps=Math.floor(length/EARTH_CIRCUM_M);
            const name=m.charAt(0).toUpperCase()+m.slice(1);
            wireParts.push(`enough ${name} wire to wrap around Earth ${formatLarge(wraps)} times`);
          }
        });
        let wireSentence="";
        if(wireParts.length===1)wireSentence=wireParts[0];
        else if(wireParts.length===2)wireSentence=wireParts.join(" and ");
        else wireSentence=wireParts.slice(0,-1).join(", ")+", and "+wireParts[wireParts.length-1];
        const wireFact=`üí° Fun fact: That‚Äôs ${wireSentence}!`;

        const ARMOR_VOLUME_M3=0.1;
        const suits=highestMetalVol/ARMOR_VOLUME_M3;
        const armorFact=`üí° Fun fact: That‚Äôs enough ${highestMetal} to dress ${formatLarge(Math.floor(suits))} knights in suits of armor! Arthur‚Äôs going to need a bigger round table.`;

        const funFacts=[
          `üí° Fun fact: That‚Äôs enough $100 bills (by volume) to fill about ${formatLarge(pools)} Olympic-size swimming pools!`,
          `üí° Fun fact: Stacked up as $100 bills, that would be about ${formatLarge(totalHeightMiles.toFixed(2))} miles tall!`,
          `üí° Fun fact: That‚Äôs enough ${highestMetal} to pave roughly ${formatLarge(blocks)} city blocks!`,
          wireFact,
          armorFact
        ];

        document.getElementById("funFact").textContent=funFacts[Math.floor(Math.random()*funFacts.length)];
        resultsPage.classList.add("active");mainPage.classList.remove("active");mainPage.style.display="none";
      }catch(e){alert("Error calculating values.");console.error(e);}
    }

    buildSliders();validateTotal();updateOverlay();

    /* Image Upload */
    document.getElementById("imageInput").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById("asteroid-img").src = e.target.result;
      };
      reader.readAsDataURL(file);
    });

    const img=document.getElementById("asteroid-img");
    let scale=1,posX=0,posY=0,startX=0,startY=0;
    img.addEventListener("pointerdown", e=>{
      startX=e.clientX-posX;startY=e.clientY-posY;img.setPointerCapture(e.pointerId);
      img.onpointermove=ev=>{posX=ev.clientX-startX;posY=ev.clientY-startY;img.style.transform=`translate(${posX}px,${posY}px) scale(${scale})`;};
      img.onpointerup=()=>img.onpointermove=null;
    });
    img.addEventListener("wheel", e=>{
      e.preventDefault();scale+=e.deltaY*-0.0015;scale=Math.min(Math.max(.5,scale),4);
      img.style.transform=`translate(${posX}px,${posY}px) scale(${scale})`;
    });
  </script>

</body>
</html>
